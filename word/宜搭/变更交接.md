## 变更交接

变更多个相关联表单

``` js
/*
目的：修改表单负责人
*/
/**
 * 变更前业务员
//  */
export function onChange({ value }) {
  // 将需要变更的客户存入全局变量中
  this.setState({
    data: value
  })
}
export function beforeSubmi({ formDataMap }){
  window.addEventListener('unhandledrejection', function (event) {
    // 阻止默认处理
    event.preventDefault();
    // 静默处理错误，仅输出你指定的内容
    console.log("Error");
  });
  console.log(this.state.data,"this.state.data1")
  // 判断当前是否选择客户/银行
  if (Array.isArray(this.state.data) && this.state.data.length > 0) {
    // 根据全局变量拿出客户/银行
    this.state.data.forEach(item => {
      const hqbm = item.subTitle // 获客编码 / 区域银行编码
      // 变更前业务员
      // 根据获编码查询业务交接底表数据，查询出需要修改的实例ID
      this.dataSourceMap['dp1'].load({
        "pageSize": 100,
        "searchFieldJson": JSON.stringify({
          "textField_lzkt12y0": String(hqbm) // 根据获客编码
        })
      }).then((res) => {
        console.log(res,"res")
        if (item.subTitle.startsWith("YHQY")) { // 银行交接
          res.data.forEach(item => {
            this.dataSourceMap['dp2'].load({ // 修改区域银行
              "formInstId": item.formData.textField_lzkuiu8v,
              "updateFormDataJson": JSON.stringify({
                "employeeField_lyi0mztb": this.state.name // 将银行联系人需改为最新负责人
              })
            }).then((res) => {
              console.log(res, "修改银行", item.subTitle)
            })
          })
        }else{
          res.data.forEach(item => { // 客户交接
            if (this.state.type == "普通交接" && item.formData.textField_lzmdigve == "1") {   // 客户普通交接
              this.dataSourceMap['dp2'].load({
                "formInstId": item.formData.textField_lzkuiu8v,
                "updateFormDataJson": JSON.stringify({
                  "employeeField_lyny2e3z": this.state.name // 将负责人修改为最新负责人
                })
              }).then((res) => {
                console.log(res, "修改", item.subTitle)
              })
            } else if (this.state.type == "离职交接" ){
              // console.log(item.formData.textField_lzkuiu8v,"x") // 离职交接
              this.dataSourceMap['dp2'].load({
                "formInstId": item.formData.textField_lzkuiu8v,
                "updateFormDataJson": JSON.stringify({
                  "employeeField_lyny2e3z": this.state.name // 将负责人修改为最新负责人
                })
              }).then((res) => {
                console.log(res, "修改", item.subTitle)
              })
            }
          })
        }
      })
      console.log("Time")
    })
  }
}

/**
* employeeField onChange
* @param value 当前值
*/
export function onChange2({ value }) {
  // 将变更后的业务员存入全局变量中  
  console.log('onChange', value);
  this.setState({
    name: value
  })
}

/**
* AssociationFormField onChange
* @param value 当前值
*/
export function onChange3({ value }) {
    // 将需要变更银行存入全局变量中
  console.log('onChange', value);
  this.setState({
    data: value
  })
  // console.log("data===>",this.state.data)

}

/**
* radioField onChange
* @param value 被选中的选项的值
*/
export function onChange4({value}){
  this.setState({
    type: value
  })
  console.log(this.state.type)
}

/**
* radioField onChange
* @param value 被选中的选项的值
*/
export function onChange5({value}){
  console.log('onChange', value);
  this.state.change_type = value
}
```

